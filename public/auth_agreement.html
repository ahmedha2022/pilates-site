<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الموافقة على الشروط | بيلاتس هاوس</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .agreement-container {
            background-color: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
            direction: rtl;
        }
        .agreement-container h1 {
            color: #bcb2a3;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        .agreement-container h2 {
            font-size: 1.75rem;
            margin-bottom: 25px;
            color: #333;
        }
        .agreement-text {
            text-align: justify;
            margin-bottom: 30px;
            color: #555;
            line-height: 1.8;
            height: 200px; /* Fixed height for scrolling */
            overflow-y: scroll;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
        }
        .agreement-text::-webkit-scrollbar {
            width: 8px;
        }
        .agreement-text::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .agreement-text::-webkit-scrollbar-thumb {
            background: #bcb2a3;
            border-radius: 10px;
        }
        .agreement-text::-webkit-scrollbar-thumb:hover {
            background: #a89e8f;
        }
        .agreement-checkbox {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .agreement-checkbox input[type="checkbox"] {
            margin-left: 10px; /* For RTL checkbox positioning */
            width: 20px;
            height: 20px;
            accent-color: #bcb2a3; /* Changes checkbox color */
        }
        .agreement-checkbox label {
            font-size: 1.1rem;
            color: #333;
            cursor: pointer;
        }
        .agreement-button {
            width: 100%;
            padding: 14px 20px;
            background-color: #bcb2a3;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .agreement-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .agreement-button:hover:not(:disabled) {
            background-color: #a89e8f;
        }
    </style>
</head>
<body>

    <div class="agreement-container">
        <h1>بيلاتس هاوس</h1>
        <h2>الموافقة على الشروط والأحكام</h2>

        <div class="agreement-text">
            <p>مرحباً بك في بيلاتس هاوس!</p>
            <p>قبل استخدام خدماتنا، يرجى قراءة والموافقة على الشروط والأحكام التالية:</p>
            <p>1. **قبول الشروط:** باستخدامك لهذا الموقع أو الخدمات التي يقدمها بيلاتس هاوس، فإنك توافق على الالتزام بهذه الشروط والأحكام وجميع القوانين واللوائح المعمول بها. إذا كنت لا توافق على أي من هذه الشروط، فلا يجوز لك استخدام الموقع أو خدماتنا.</p>
            <p>2. **الخصوصية:** سيتم جمع المعلومات الشخصية التي تقدمها لنا وتخزينها واستخدامها وفقًا لسياسة الخصوصية الخاصة بنا. يرجى مراجعة سياسة الخصوصية لفهم كيفية تعاملنا مع بياناتك.</p>
            <p>3. **الحجوزات والإلغاء:** يجب أن تتم جميع الحجوزات مسبقًا. تخضع سياسات الإلغاء لاسترداد المبلغ أو إعادة جدولة الحصص لإشعار مسبق.  يرجى الرجوع إلى صفحة الأسعار والباقات للحصول على تفاصيل محددة بشأن سياسات الإلغاء للحصص الفردية والباقات.</p>
            <p>4. **اللياقة الصحية:** يؤكد المستخدم أنه في حالة صحية جيدة تسمح له بممارسة تمارين البيلاتس. يرجى استشارة طبيبك قبل البدء في أي برنامج رياضي جديد، وإبلاغ المدرب عن أي حالات صحية أو إصابات سابقة.</p>
            <p>5. **المسؤولية:** بيلاتس هاوس غير مسؤول عن أي إصابات أو أضرار قد تحدث أثناء ممارسة البيلاتس أو استخدام المرافق، ما لم تكن ناجمة عن إهمال جسيم من جانبنا. تقع مسؤولية سلامتك الشخصية على عاتقك.</p>
            <p>6. **الملكية الفكرية:** جميع المحتويات الموجودة على هذا الموقع، بما في ذلك النصوص والصور والتصاميم والبرامج، هي ملكية فكرية لبيلاتس هاوس ومحمية بموجب قوانين حقوق النشر. لا يجوز نسخها أو توزيعها أو تعديلها دون إذن كتابي مسبق.</p>
            <p>7. **السلوك:** يحترم جميع المستخدمين والمعلمين والعاملين في بيلاتس هاوس. يمنع أي سلوك غير لائق أو مزعج أو غير قانوني.</p>
            <p>8. **التعديلات على الشروط والأحكام:** يحتفظ بيلاتس هاوس بالحق في تعديل هذه الشروط والأحكام في أي وقت. سيتم نشر أي تغييرات على هذه الصفحة، ويعتبر استمرارك في استخدام الموقع بعد نشر التغييرات قبولًا منك لتلك التغييرات.</p>
            <p>9. **القانون المعمول به:** تخضع هذه الشروط والأحكام وتفسر وفقًا لقوانين دولة قطر.</p>
            <p>شكراً لاختيار بيلاتس هاوس!</p>
        </div>

        <div class="agreement-checkbox">
            <input type="checkbox" id="agreeCheckbox">
            <label for="agreeCheckbox">أوافق على الشروط والأحكام.</label>
        </div>

        <button id="agreeButton" class="agreement-button" disabled>موافق</button>
    </div>

    <!-- Custom Modal Container (Add this just before the closing </body> tag) -->
    <div id="customModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[9999] opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full transform -translate-y-4 opacity-0 transition-all duration-300 scale-95" id="modalContent">
            <h3 class="text-xl font-bold text-[#bcb2a3] mb-4 text-center" id="modalTitle"></h3>
            <p class="text-gray-700 mb-6 text-center" id="modalMessage"></p>
            <div class="flex justify-center gap-4" id="modalButtons">
                <!-- Buttons will be injected here by JS -->
            </div>
        </div>
    </div>

    <script>
        // Global modal functions (copied from index.html)
        const customModal = document.getElementById('customModal');
        const modalContent = document.getElementById('modalContent');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalButtons = document.getElementById('modalButtons');

        function showModal(title, message, buttons) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalButtons.innerHTML = ''; // Clear previous buttons

            buttons.forEach(btn => {
                const buttonElement = document.createElement('button');
                buttonElement.textContent = btn.text;
                buttonElement.className = `px-6 py-2 rounded-lg font-medium transition ${btn.className || 'bg-[#bcb2a3] text-white hover:bg-[#a89e8f]'}`;
                buttonElement.onclick = () => {
                    hideModal(); // Hide modal on button click
                    if ((btn.value === true || btn.value === false || btn.value === null) && btn.callback) {
                        btn.callback(btn.value); // For confirm/cancel dialogs
                    } else if (btn.callback) {
                        btn.callback(); // For simple OK dialogs
                    }
                };
                modalButtons.appendChild(buttonElement);
            });

            customModal.classList.remove('opacity-0', 'pointer-events-none');
            modalContent.classList.remove('-translate-y-4', 'opacity-0', 'scale-95');
            modalContent.classList.add('translate-y-0', 'opacity-100', 'scale-100');
        }

        function hideModal() {
            customModal.classList.add('opacity-0', 'pointer-events-none');
            modalContent.classList.add('-translate-y-4', 'opacity-0', 'scale-95');
            modalContent.classList.remove('translate-y-0', 'opacity-100', 'scale-100');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const agreeCheckbox = document.getElementById('agreeCheckbox');
            const agreeButton = document.getElementById('agreeButton');

            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser && !localStorage.getItem('justSignedUp')) {
                console.warn('Unauthorized access to auth_agreement.html. Redirecting to auth page.');
                window.location.href = 'auth.html';
                return;
            }

            agreeCheckbox.addEventListener('change', () => {
                agreeButton.disabled = !agreeCheckbox.checked;
            });

            agreeButton.addEventListener('click', () => {
                if (agreeCheckbox.checked) {
                    localStorage.removeItem('justSignedUp'); 
                    
                    const pendingPackageBook = localStorage.getItem('pendingPackageBook');
                    if (pendingPackageBook) {
                        try {
                            const packageDetails = JSON.parse(pendingPackageBook);
                            let userPackages = JSON.parse(localStorage.getItem('userPackages') || '[]');
                            
                            const isDuplicate = userPackages.some(pkg => 
                                pkg.packageName === packageDetails.packageName &&
                                pkg.sessionsTotal === packageDetails.sessionsTotal
                            );

                            if (!isDuplicate) {
                                userPackages.push({ 
                                    ...packageDetails, 
                                    bookedDate: new Date().toISOString(),
                                    status: 'active',
                                    id: Date.now() + Math.random().toString(36).substring(2, 9) 
                                });
                                localStorage.setItem('userPackages', JSON.stringify(userPackages));
                                console.log('Pending package added:', packageDetails);
                            } else {
                                console.log('Pending package was a duplicate, not re-added.');
                            }
                            
                            localStorage.removeItem('pendingPackageBook'); 
                            showModal('تمت الموافقة!', 'تمت الموافقة على الشروط! سيتم إضافة الباقة إلى حسابك وتحويلك لملفك الشخصي.', [{ text: 'موافق', callback: () => {
                                window.location.href = 'profile.html'; 
                            }}]);
                        } catch (e) {
                            console.error('Error parsing pendingPackageBook:', e);
                            localStorage.removeItem('pendingPackageBook'); 
                            showModal('خطأ!', 'حدث خطأ في معالجة طلب الباقة. سيتم تحويلك للصفحة الرئيسية.', [{ text: 'موافق', callback: () => {
                                window.location.href = 'index.html'; 
                            }}]);
                        }
                    } else {
                        if (currentUser) { 
                             showModal('تمت الموافقة!', 'تمت الموافقة على الشروط! سيتم تحويلك لملفك الشخصي.', [{ text: 'موافق', callback: () => {
                                window.location.href = 'profile.html'; 
                            }}]);
                        } else {
                             showModal('تمت الموافقة!', 'تمت الموافقة على الشروط! سيتم تحويلك للصفحة الرئيسية.', [{ text: 'موافق', callback: () => {
                                window.location.href = 'index.html'; 
                            }}]);
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
